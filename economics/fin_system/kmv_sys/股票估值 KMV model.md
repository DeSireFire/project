# 股票估值 KMV model

这里我希望利用KMV 模型来进行股票估值分析。KMV 模型一般用来对上市公司信用违约风险的衡量和分析。但由于其涉及到公司市值和股价波动，因此，我希望能够反过来利用该模型对公司未来波动进行估值。

## KMV 简介

KMV 模型围绕着一个核心问题：当公司无法偿还其负债时，将会发生什么？其核心思想受启发于 BS - 期权定价公式：公司的权益价值可以被视为对当前标的资产的看涨期权(call option)。

其通过可观察到的股票价值($V_E$)和波动率($\sigma_E$)来计算公司资产的真实价值($V_A$)和真实波动率($\sigma_A$) 

基于 BS-期权定价公式，股权价值是公司资产的看涨期权，因此我们有如下对应关系：
$$
C(t) = S(t) \cdot \Phi (d_1) -e^{-r(T-t)} \cdot K \cdot \Phi (d_2)
$$
则我们有
$$
V_E(t)= V_A(t) \cdot \Phi(d_1) -e^{-r(T-t)} \cdot D \cdot \Phi(d_2)
$$
Ito's Lemma， 可以得到
$$
\sigma_E = \frac{V_A}{V_E} \cdot \frac{\partial V_E}{\partial V_A} \cdot \sigma_A =  \frac{V_A}{V_E} \cdot \Phi(d_1) \cdot \sigma_A
$$
未知变量：$V_A$,$\sigma_A$ 

已知变量：$V_E$,$\sigma_E$, $r$
$$
\begin{align}
d_1 &= &\frac{
    \log (V_A (t) / D) +(r-\frac{1}{2} \sigma^2_A)(T-t)
}{\sigma_A \sqrt{T-t}} \\
d_2 &=& d_1 - \sigma\sqrt{T-t}
\end{align}
$$
根据上述分析，我们可以构建如下非线性方程组来计算：
$$
\begin{align}
f_1 &= & V_A(t) \cdot \Phi(d_1) -e^{-r(T-t)} \cdot D \cdot \Phi(d_2) - V_E (t) \\
f_2 &= & \frac{V_A}{V_E} \cdot \Phi(d_1) \cdot \sigma_A - \sigma_E
\end{align}
$$
接下来我们即可以计算违约概率：
$$
\begin{align} 
Pr \{ V_A \leq D\}  &=& ... = \Phi (- DD) \\
DD & = & \frac{\log (V_A /D ) +(r-\frac{1}{2}\sigma^2_A ) (T-t) }{\sigma_A \sqrt {T-t}}
\end{align}
$$

## 股票估值

之前的想法不对。我们是利用企业市值(market cap) 来充当 $V_E$ 进行KMV 资产价值与违约概率的计算。利用KMV计算出来的$V_A$ 与企业自身报表中的$V_A$ 是不同的。现在我能够想到的就是利用当前的企业市值和企业负债情况，计算$V_A$ 和 $\sigma_A$ 然后计算未来$V_A$ 的波动区间。 从而计算未来市值的波动区间。









通过上一部分的介绍，我们可以了解到KMV 模型如何得到资产的价值和波动率。如果对股票进行估值，我们可以使用逆向计算方法，通过给定违约概率来计算得到公司股票权益的价值。这里我们需要有基准的资产和权益价值，从而在基准数据基础上来对未来公司价值进行分析。因此我们可以有如下步骤：

* 根据年报得到当时公司资产、权益与负债情况
* 根据KMV公式，计算资产波动率与影子资产价值
* 根据波动率，给定估值期限，得到未来预期波动率水平
* 给定资产增长预期假设，计算未来公司预期资产水平和负债水平
* 根据期权定价公式，得到公司预期权益价值，并得到预期股票价格



**注意** 其实延伸出去，我们完全可以利用诸如 主营收入、营业成本等指标来替代 资产、负债进行股票分析。进一步可以根据神经网络等来进行股票估值分析



所需要数据：

1. 股票历史数据
2. 股本数据-（利用市值和当前股价）
3. 总资产、总负债价值
4. 短期负债，长期负债
5. 资产增长率
6. 未来增长预期



* 对于中国股票市场，数据来源tushare package 
* 对于美国股票市场，数据来源yahoofinancials 

发现中国股票市场废了 tushare 无法获取财报数据了

